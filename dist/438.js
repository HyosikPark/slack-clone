(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[438],{4438:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n(7294),a=n(5366);const l=(0,a.Z)("div",{target:"e1h9704l1"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),s=(0,a.Z)("header",{target:"e1h9704l0"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});var c=n(6182),o=n.n(c),i=n(8100),u=n(3564),d=n(5977),h=n(9419),p=n(6471),g=n(9669),m=n.n(g),f=n(8667),k=n(2951),w=n(9249),x=n(917);function Z(){const{workspace:e,id:t}=(0,d.UO)(),{data:n}=(0,i.ZP)(`/api/workspaces/${e}/users/${t}`,u._),{data:a}=(0,i.ZP)("/api/users",u._),{data:c,mutate:g,revalidate:Z,setSize:b}=(0,i.g_)((n=>`/api/workspaces/${e}/dms/${t}/chats?perPage=20&page=${n+1}`),u._),[v,C]=(0,r.useState)(""),[S]=(0,k.Z)(e),$=(0,r.useRef)(null),T=0===c?.[0]?.length||c&&c[c.length-1]?.length<20||!1,_=(0,r.useCallback)((e=>{C(e.target.value)}),[]),y=(0,r.useCallback)((r=>{if(r.preventDefault(),!v.trim()||!c)return;const l=v;g((e=>(e?.[0].unshift({id:(c[0][0]?.id||0)+1,content:l,SenderId:a.id,Sender:a,ReceiverId:n.id,Receiver:n,createdAt:new Date}),e)),!1).then((()=>{C(""),$.current?.scrollToBottom()})),m().post(`/api/workspaces/${e}/dms/${t}/chats`,{content:v}).then((()=>Z())).catch((e=>console.log(e)))}),[v,c,t,g,a,Z,n,e]),B=(0,r.useCallback)((e=>{e.SenderId===Number(t)&&a.id!==Number(t)&&g((t=>(t?.[0].unshift(e),t)),!1).then((()=>{Z(),$.current&&($.current.getScrollHeight()<$.current.getClientHeight()+$.current.getScrollTop()+150?(console.log("scrollToBottom!",$.current?.getValues()),$.current.scrollToBottom()):w.Am.success("새 메시지가 도착했습니다.",{onClick(){$.current?.scrollToBottom()},closeOnClick:!0}))}))}),[t,g,a.id,Z]);if((0,r.useEffect)((()=>(S?.on("dm",B),()=>{S?.off("dm",B)})),[B,Z,S]),(0,r.useEffect)((()=>{1===c?.length&&$.current&&$.current?.scrollToBottom()}),[c]),!n||!a||!c)return null;const R=(0,f.Z)(c.flat().reverse());return(0,x.tZ)(l,null,(0,x.tZ)(s,null,(0,x.tZ)("img",{src:o().url(n.nickname,{s:"24px",d:"retro"}),alt:n.nickname}),(0,x.tZ)("span",null,n.nickname)),(0,x.tZ)(h.Z,{chatSections:R,scrollbarRef:$,setSize:b,isReachingEnd:T}),(0,x.tZ)(p.Z,{placeholder:`Message ${n.nickname}`,chat:v,onSubmitForm:y,onChangeChat:_}))}const b=r.memo(Z)}}]);