(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[818],{5818:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var a=n(7294),l=n(5366);const s=(0,l.Z)("div",{target:"e1wt1b281"})({name:"l986mw",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column"}),o=(0,l.Z)("header",{target:"e1wt1b280"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});var r=n(8100),c=n(3564),i=n(5977),u=n(9419),h=n(6471),p=n(9669),d=n.n(p),m=n(8667),f=n(2951),g=n(9249),b=n(3732),w=n(3046),Z=n(917);function k({show:e,onCloseModal:t}){const{workspace:n,channel:l}=(0,i.UO)(),s=(0,a.useRef)(null),o=(0,a.useCallback)((e=>{e.preventDefault(),s.current?.value.trim()&&d().post(`/api/workspaces/${n}/channels/${l}/members`,{email:s.current.value},{withCredentials:!0}).then((()=>{(0,r.X$)(`/api/workspaces/${n}/channels/${l}/members`),t()})).catch((e=>{g.Am.error(e.response?.data,{position:"bottom-center"})}))}),[l,t,n]);return(0,Z.tZ)(b.Z,{show:e},(0,Z.tZ)("form",{onSubmit:o},(0,Z.tZ)(w.__,{id:"member-label"},(0,Z.tZ)("span",null,"채널 멤버 초대"),(0,Z.tZ)(w.II,{id:"member",type:"email",ref:s})),(0,Z.tZ)(w.zx,{type:"submit"},"초대하기")))}const _=a.memo(k);function C({onOpenModal:e,show:t,onCloseModal:n}){const{workspace:l,channel:p}=(0,i.UO)(),{data:b}=(0,r.ZP)("/api/users",c._),{data:w}=(0,r.ZP)(`/api/workspaces/${l}/channels/${p}`,c._),{data:k,mutate:C,revalidate:v,setSize:x}=(0,r.g_)((e=>`/api/workspaces/${l}/channels/${p}/chats?perPage=20&page=${e+1}`),c._),{data:$}=(0,r.ZP)(b?`/api/workspaces/${l}/channels/${p}/members`:null),[y,S]=(0,a.useState)(""),[I]=(0,f.Z)(l),T=(0,a.useRef)(null),B=0===k?.[0]?.length||k&&k[k.length-1]?.length<20||!1,M=(0,a.useCallback)((e=>{S(e.target.value)}),[]),U=(0,a.useCallback)((e=>{if(e.preventDefault(),!y.trim()||!k||!w)return;const t=y;C((e=>(e?.[0].unshift({id:(k[0][0]?.id||0)+1,content:t,UserId:b.id,User:b,ChannelId:w.id,Channel:w,createdAt:new Date}),e)),!1).then((()=>{S(""),T.current?.scrollToBottom()})),d().post(`/api/workspaces/${l}/channels/${p}/chats`,{content:y}).then((()=>v())).catch((e=>console.log(e)))}),[p,w,y,k,C,b,v,l]),z=(0,a.useCallback)((e=>{e.Channel.name===p&&e.UserId!==b?.id&&C((t=>(t?.[0].unshift(e),t)),!1).then((()=>{v(),T.current&&(T.current.getScrollHeight()<T.current.getClientHeight()+T.current.getScrollTop()+150?(console.log("scrollToBottom!",T.current?.getValues()),T.current.scrollToBottom()):g.Am.success("새 메시지가 도착했습니다.",{onClick(){T.current?.scrollToBottom()},closeOnClick:!0}))}))}),[p,C,b?.id,v]);if((0,a.useEffect)((()=>(I?.on("message",z),()=>{I?.off("message",z)})),[z,I]),(0,a.useEffect)((()=>{1===k?.length&&T.current&&T.current?.scrollToBottom()}),[k]),!b||!k)return null;const A=(0,m.Z)(k.flat().reverse());return(0,Z.tZ)(s,null,(0,Z.tZ)(o,null,(0,Z.tZ)("span",null,"#",p),(0,Z.tZ)("div",{className:"header-right"},(0,Z.tZ)("span",null,$?.length),(0,Z.tZ)("button",{id:"open-ic-btn",onClick:e,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},(0,Z.tZ)("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),(0,Z.tZ)(u.Z,{scrollbarRef:T,isReachingEnd:B,chatSections:A,setSize:x}),(0,Z.tZ)(h.Z,{onSubmitForm:U,chat:y,onChangeChat:M,placeholder:`Message #${p}`}),(0,Z.tZ)(_,{show:t,onCloseModal:n}),(0,Z.tZ)(g.Ix,{position:"bottom-center"}))}const v=a.memo(C)}}]);